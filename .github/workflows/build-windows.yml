name: Build Windows Executable # Tên của workflow, bạn có thể đặt tùy ý

on: # Các sự kiện kích hoạt workflow
  push: # Chạy mỗi khi có push lên bất kỳ branch nào
    branches:
      - main # Hoặc master, hoặc branch chính của bạn
      - develop # Ví dụ
  workflow_dispatch: # Cho phép chạy thủ công từ tab Actions trên GitHub

jobs:
  build-windows:
    runs-on: windows-latest # Chỉ định chạy trên máy ảo Windows mới nhất

    steps:
      - name: Check out repository code # Bước 1: Lấy code từ kho chứa
        uses: actions/checkout@v4 # Sử dụng một action có sẵn của GitHub

      - name: Set up Python # Bước 2: Cài đặt Python
        uses: actions/setup-python@v5 # Sử dụng action cài Python
        with:
          python-version: '3.12' # Chọn phiên bản Python bạn dùng (ví dụ 3.12)

      - name: Install dependencies # Bước 3: Cài đặt các thư viện
        run: |
          python -m pip install --upgrade pip
          pip install pyinstaller
          # Đảm bảo file requirements.txt có trong kho chứa của bạn
          if (Test-Path requirements.txt) { pip install -r requirements.txt } 

      - name: Run PyInstaller to build executable # Bước 4: Chạy PyInstaller
        run: |
          pyinstaller --windowed ^
                      --name "QuanLyKhamBenh" ^
                      --add-data "patients_data.csv;." ^
                      --add-data "doctors_data.csv;." ^
                      --add-data "clinics_data.csv;." ^
                      --clean ^
                      main_gui.py
        # Lưu ý: 
        # - Dùng dấu ^ để xuống dòng trong PowerShell/CMD của Windows.
        # - Dùng dấu ; làm phân cách trong --add-data trên Windows.
        # - Đảm bảo các file data (patients_data.csv,...) nằm ở thư mục gốc của kho chứa
        #   hoặc bạn cần điều chỉnh đường dẫn tương đối cho đúng.

      - name: Upload Windows executable artifact # Bước 5: Tải lên file đã build
        uses: actions/upload-artifact@v4
        with:
          name: QuanLyKhamBenh-Windows-exe # Tên của artifact bạn sẽ thấy để tải về
          path: dist/QuanLyKhamBenh # Đường dẫn đến thư mục chứa file .exe và các file liên quan
                                    # PyInstaller với --windowed thường tạo ra một thư mục trong 'dist'
                                    # Nếu bạn dùng --onefile, đường dẫn sẽ là dist/QuanLyKhamBenh.exe
